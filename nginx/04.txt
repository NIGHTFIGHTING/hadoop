82.反向代理与负载均衡原理
------------------------------------------------------
http模块7层反向代理
stream模块4层反向代理

一个请求到达nginx,到转发上游服务,转发客户端
1)负载均衡
ngx为一个应用服务集群,提升应用服务的可用性.包括容灾和扩容
可扩展性如何通过ngx保护的?
Nginx在AKF扩展立方体上的应用
1]X轴扩展:我们的服务是无状态的,无论启多少个服务,他们是同等为用户请求服务的
称为水平扩展,成本最低.nginx的round-robin/least-conected是基于水平扩展的算法
水平扩展不能解决所有问题,尤其是不能解决数据量问题.单台数据量大的时候,无论扩展多少台服务,i
每一台服务数据依然非常大
2]Y轴进行拆分:原来有一台应用服务处理的功能,分为两台应用服务.分别处理不同的api(处理不同的url)
nginx可以基于URL的location进行配置,有些location可以通过proxy_pass代理到上游服务器中.对功能进行分发
需要更改代码,做大量重构,成本比较高
3]Z轴基于用户信息进行扩展:
比如可以基于用户ip地址,我们的cdn.发现某一些ip地址靠近某一个cdn中心.可以把这样的请求引流到这个cdn
上,
为了分离减少数据容量,可以根据用户名,某些固定用户引流到固定集群
nginx的hash算法可以用于基于Z轴扩展

反向代理分为两大类:
4层
7层:http中含有大量业务信息,当client发来http请求后,根据http的header,method等等信息,
可以转换为不同协议

2)缓存
1]时间缓存:用户方位 index.html通过internet网,到达nginx,index.html在nginx没有缓存所以访问,所以
访问应用服务器.应用服务器的响应到达nginx,nginx做两件事,nginx把respose发给用户;把相应缓存在
这台机器的磁盘上
当另一个用户请求index.html,nginx发现这个页面已经缓存,且在缓存有效期内,直接响应用户.减少环节,
且nginx比应用服务器性能更好
2]空间缓存
当访问应用服务器内容,nginx可以加快速度欲取一些响应的内容,放在nginx上

83.负载均衡策略：round-robin
-----------------------------------------------------
